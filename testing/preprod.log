####################################################################################################
######################################### SPEND TEST CASE ##########################################
####################################################################################################


[nix-shell:~/src/traceability-smart-contract]$ cardano-cli query utxo --address addr_test1wp98u3s8wjrfxpjlerzlw2wg9a6k5ws8cc25gadtcxfe7xs6g8lm9 --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18     1        20000000 lovelace + TxOutDatumNone
f7c58a4d27ebc11f0f63ba632d568604d12c2a286de3927295ccb64412de0110     0        101620000 lovelace + TxOutDatumInline ReferenceTxInsScriptsInlineDatumsInBabbageEra (ScriptDataConstructor 0 [ScriptDataNumber 101120000,ScriptDataBytes "4652878069825"])


lawrence@lawrence-MacBookAir:~/src/traceability-smart-contract/scripts/cardano-cli$ ./spend-tx.sh preprod
+ '[' -z preprod ']'
+ ENV=preprod
+++ readlink -f ./spend-tx.sh
++ dirname /home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/spend-tx.sh
+ MY_DIR=/home/lawrence/src/traceability-smart-contract/scripts/cardano-cli
+ source /home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export BASE=/home/lawrence/src/traceability-smart-contract
++ BASE=/home/lawrence/src/traceability-smart-contract
++ export WORK=/home/lawrence/src/traceability-smart-contract/work
++ WORK=/home/lawrence/src/traceability-smart-contract/work
++ export CARDANO_CLI=/usr/local/bin/cardano-cli
++ CARDANO_CLI=/usr/local/bin/cardano-cli
++ export BECH32=/usr/local/bin/bech32
++ BECH32=/usr/local/bin/bech32
++ export CARDANO_NODE_SOCKET_PATH=/var/snap/docker/common/var-lib-docker/volumes/cardano-ipc/_data/node.socket
++ CARDANO_NODE_SOCKET_PATH=/var/snap/docker/common/var-lib-docker/volumes/cardano-ipc/_data/node.socket
++ export TESTNET_MAGIC=1
++ TESTNET_MAGIC=1
++ export ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/admin.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/admin.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/admin.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/admin.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/admin.hash
++ ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/admin.hash
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export MIN_ADA_OUTPUT_TX_REF=20000000
++ MIN_ADA_OUTPUT_TX_REF=20000000
++ export COLLATERAL_ADA=5000000
++ COLLATERAL_ADA=5000000
++ export MERCHANT_ADDR=addr_test1vq7k907l7e59t52skm8e0ezsnmmc7h4xy30kg2klwc5n8rqug2pds
++ MERCHANT_ADDR=addr_test1vq7k907l7e59t52skm8e0ezsnmmc7h4xy30kg2klwc5n8rqug2pds
++ export DONOR_ADDR=addr_test1vzetpfww4aaunft0ucvcrxugj8nt4lhltsktya0rx0uh48cqghjfg
++ DONOR_ADDR=addr_test1vzetpfww4aaunft0ucvcrxugj8nt4lhltsktya0rx0uh48cqghjfg
++ export REFUND_ADDR=addr_test1vzs24vjh8salzqt5pahgvr34ewfwagxaxr5pz7eswugzn2gmw4f5w
++ REFUND_ADDR=addr_test1vzs24vjh8salzqt5pahgvr34ewfwagxaxr5pz7eswugzn2gmw4f5w
++ export VAL_REF_SCRIPT=b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18#1
++ VAL_REF_SCRIPT=b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18#1
++ export SPLIT=95
++ SPLIT=95
++ export BLOCKFROST_API_KEY=preprodxg6GaNVZoHWUfQd7HQcgUg8epWhE1aMi
++ BLOCKFROST_API_KEY=preprodxg6GaNVZoHWUfQd7HQcgUg8epWhE1aMi
++ export BLOCKFROST_API=https://cardano-preprod.blockfrost.io/api/v0
++ BLOCKFROST_API=https://cardano-preprod.blockfrost.io/api/v0
+ '[' preprod == mainnet ']'
+ network='--testnet-magic 1'
+ echo 'Socket path: /var/snap/docker/common/var-lib-docker/volumes/cardano-ipc/_data/node.socket'
Socket path: /var/snap/docker/common/var-lib-docker/volumes/cardano-ipc/_data/node.socket
+ ls -al /var/snap/docker/common/var-lib-docker/volumes/cardano-ipc/_data/node.socket
srwxrwxrwx 1 root root 0 Nov  6 07:52 /var/snap/docker/common/var-lib-docker/volumes/cardano-ipc/_data/node.socket
+ mkdir -p /home/lawrence/src/traceability-smart-contract/work
+ mkdir -p /home/lawrence/src/traceability-smart-contract/work-backup
+ rm -f /home/lawrence/src/traceability-smart-contract/work/admin-utxo-collateral-valid.json /home/lawrence/src/traceability-smart-contract/work/admin-utxo-valid.json /home/lawrence/src/traceability-smart-contract/work/admin-utxo.json /home/lawrence/src/traceability-smart-contract/work/init-tx-alonzo.body /home/lawrence/src/traceability-smart-contract/work/init-tx-alonzo.tx /home/lawrence/src/traceability-smart-contract/work/pparms.json
+ rm -f '/home/lawrence/src/traceability-smart-contract/work-backup/*'
+ /usr/local/bin/cardano-cli query protocol-parameters --testnet-magic 1 --out-file /home/lawrence/src/traceability-smart-contract/work/pparms.json
+ validator_script=/home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/data/earthtrust-validator.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/data/earthtrust-validator.plutus --testnet-magic 1
+ validator_script_addr=addr_test1wp98u3s8wjrfxpjlerzlw2wg9a6k5ws8cc25gadtcxfe7xs6g8lm9
+ redeemer_file_path=/home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/data/redeemer-earthtrust-spend.json
++ cat /home/lawrence/.local/keys/testnet/admin/admin.hash
+ admin_pkh=b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682
++ /usr/local/bin/cardano-cli address build --testnet-magic 1 --payment-verification-key-file /home/lawrence/.local/keys/testnet/admin/admin.vkey
+ admin_utxo_addr=addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7
+ /usr/local/bin/cardano-cli query utxo --address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --cardano-mode --testnet-magic 1 --out-file /home/lawrence/src/traceability-smart-contract/work/admin-utxo.json
+ cat /home/lawrence/src/traceability-smart-contract/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18#0
++ tr -d '\n'
+ admin_utxo_in=b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18#0
+ cat /home/lawrence/src/traceability-smart-contract/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace == 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 5052d9b69c914b61cefb7667d54b023de53e0b1368bf436aff1f141d0f675559#0
++ tr -d '\n'
+ admin_utxo_collateral_in=5052d9b69c914b61cefb7667d54b023de53e0b1368bf436aff1f141d0f675559#0
+ /usr/local/bin/cardano-cli query utxo --address addr_test1wp98u3s8wjrfxpjlerzlw2wg9a6k5ws8cc25gadtcxfe7xs6g8lm9 --testnet-magic 1 --out-file /home/lawrence/src/traceability-smart-contract/work/validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.inlineDatum 
| length > 0) | .key' /home/lawrence/src/traceability-smart-contract/work/validator-utxo.json
+ order_utxo_in=f7c58a4d27ebc11f0f63ba632d568604d12c2a286de3927295ccb64412de0110#0
++ jq -r 'to_entries[] 
| select(.value.inlineDatum 
| length > 0) 
| .value.inlineDatum' /home/lawrence/src/traceability-smart-contract/work/validator-utxo.json
+ order_datum_in='{
  "constructor": 0,
  "fields": [
    {
      "int": 101120000
    },
    {
      "bytes": "34363532383738303639383235"
    }
  ]
}'
+ echo -n '{
  "constructor": 0,
  "fields": [
    {
      "int": 101120000
    },
    {
      "bytes": "34363532383738303639383235"
    }
  ]
}'
++ jq -r '.fields[0].int' /home/lawrence/src/traceability-smart-contract/work/datum-in.json
+ order_ada=101120000
++ jq -r '.fields[1].bytes' /home/lawrence/src/traceability-smart-contract/work/datum-in.json
+ order_id=34363532383738303639383235
++ echo -n 34363532383738303639383235=
++ xxd -r -p
+ order_id_non_hex=4652878069825
++ jq -r '.fields[2].int' /home/lawrence/src/traceability-smart-contract/work/datum-in.json
+ service_fee=null
+ merchant_split=95
+ donor_split=5
+ merchant_ada=96064000
+ donor_ada=5056000
++ date +%Y/%m/%d-%H:%M:%S
+ now=2022/11/06-14:42:17
+ metadata='{
"1" : {
    "order_detail" : {
        "date" : "2022/11/06-14:42:17",
        "donation_ada_amount" : "5056000",
        "donation_split" : "5%",
        "order_id" : "4652878069825",
        "order_ada_amount" : "101120000",
        "version" : "1.0"
        }
    }
}'
+ echo '{' '"1"' : '{' '"order_detail"' : '{' '"date"' : '"2022/11/06-14:42:17",' '"donation_ada_amount"' : '"5056000",' '"donation_split"' : '"5%",' '"order_id"' : '"4652878069825",' '"order_ada_amount"' : '"101120000",' '"version"' : '"1.0"' '}' '}' '}'
+ metadata_file_path=/home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/data/earthtrust-metadata.json
+ /usr/local/bin/cardano-cli transaction build --babbage-era --cardano-mode --testnet-magic 1 --change-address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --tx-in-collateral 5052d9b69c914b61cefb7667d54b023de53e0b1368bf436aff1f141d0f675559#0 --tx-in b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18#0 --tx-in f7c58a4d27ebc11f0f63ba632d568604d12c2a286de3927295ccb64412de0110#0 --spending-tx-in-reference b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18#1 --spending-plutus-script-v2 --spending-reference-tx-in-inline-datum-present --spending-reference-tx-in-redeemer-file /home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/data/redeemer-earthtrust-spend.json --tx-out addr_test1vq7k907l7e59t52skm8e0ezsnmmc7h4xy30kg2klwc5n8rqug2pds+96064000 --tx-out addr_test1vzetpfww4aaunft0ucvcrxugj8nt4lhltsktya0rx0uh48cqghjfg+5056000 --required-signer-hash b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682 --protocol-params-file /home/lawrence/src/traceability-smart-contract/work/pparms.json --metadata-json-file /home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/data/earthtrust-metadata.json --out-file /home/lawrence/src/traceability-smart-contract/work/add-ada-tx-alonzo.body
Estimated transaction fee: Lovelace 328270
+ echo 'tx has been built'
tx has been built
+ /usr/local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/traceability-smart-contract/work/add-ada-tx-alonzo.body --testnet-magic 1 --signing-key-file /home/lawrence/.local/keys/testnet/admin/admin.skey --out-file /home/lawrence/src/traceability-smart-contract/work/add-ada-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /usr/local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/traceability-smart-contract/work/add-ada-tx-alonzo.tx --testnet-magic 1
Transaction successfully submitted.


[nix-shell:~/src/traceability-smart-contract]$ cardano-cli query utxo --address addr_test1wp98u3s8wjrfxpjlerzlw2wg9a6k5ws8cc25gadtcxfe7xs6g8lm9 --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18     1        20000000 lovelace + TxOutDatumNone




####################################################################################################
########################################  REFUND TEST CASE #########################################
####################################################################################################


[nix-shell:~/src/traceability-smart-contract/scripts/cardano-cli]$ cardano-cli query utxo --address addr_test1wp98u3s8wjrfxpjlerzlw2wg9a6k5ws8cc25gadtcxfe7xs6g8lm9 --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
1c335fe9e3912f5b6b3a0245d9cc756fe883fdf6cd69e2d5fec141199eea35f0     0        101760000 lovelace + TxOutDatumInline ReferenceTxInsScriptsInlineDatumsInBabbageEra (ScriptDataConstructor 0 [ScriptDataNumber 101260000,ScriptDataBytes "4652915064897"])
b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18     1        20000000 lovelace + TxOutDatumNone



lawrence@lawrence-MacBookAir:~/src/traceability-smart-contract/scripts/cardano-cli$ ./refund-tx.sh preprod 1c335fe9e3912f5b6b3a0245d9cc756fe883fdf6cd69e2d5fec141199eea35f0 0
+ '[' -z preprod ']'
+ ENV=preprod
+++ readlink -f ./refund-tx.sh
++ dirname /home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/refund-tx.sh
+ MY_DIR=/home/lawrence/src/traceability-smart-contract/scripts/cardano-cli
+ source /home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export BASE=/home/lawrence/src/traceability-smart-contract
++ BASE=/home/lawrence/src/traceability-smart-contract
++ export WORK=/home/lawrence/src/traceability-smart-contract/work
++ WORK=/home/lawrence/src/traceability-smart-contract/work
++ export CARDANO_CLI=/usr/local/bin/cardano-cli
++ CARDANO_CLI=/usr/local/bin/cardano-cli
++ export BECH32=/usr/local/bin/bech32
++ BECH32=/usr/local/bin/bech32
++ export CARDANO_NODE_SOCKET_PATH=/var/snap/docker/common/var-lib-docker/volumes/cardano-ipc/_data/node.socket
++ CARDANO_NODE_SOCKET_PATH=/var/snap/docker/common/var-lib-docker/volumes/cardano-ipc/_data/node.socket
++ export TESTNET_MAGIC=1
++ TESTNET_MAGIC=1
++ export ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/admin.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/admin.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/admin.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/admin.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/admin.hash
++ ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/admin.hash
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export MIN_ADA_OUTPUT_TX_REF=20000000
++ MIN_ADA_OUTPUT_TX_REF=20000000
++ export COLLATERAL_ADA=5000000
++ COLLATERAL_ADA=5000000
++ export MERCHANT_ADDR=addr_test1vq7k907l7e59t52skm8e0ezsnmmc7h4xy30kg2klwc5n8rqug2pds
++ MERCHANT_ADDR=addr_test1vq7k907l7e59t52skm8e0ezsnmmc7h4xy30kg2klwc5n8rqug2pds
++ export DONOR_ADDR=addr_test1vzetpfww4aaunft0ucvcrxugj8nt4lhltsktya0rx0uh48cqghjfg
++ DONOR_ADDR=addr_test1vzetpfww4aaunft0ucvcrxugj8nt4lhltsktya0rx0uh48cqghjfg
++ export REFUND_ADDR=addr_test1vzs24vjh8salzqt5pahgvr34ewfwagxaxr5pz7eswugzn2gmw4f5w
++ REFUND_ADDR=addr_test1vzs24vjh8salzqt5pahgvr34ewfwagxaxr5pz7eswugzn2gmw4f5w
++ export VAL_REF_SCRIPT=b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18#1
++ VAL_REF_SCRIPT=b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18#1
++ export SPLIT=95
++ SPLIT=95
++ export BLOCKFROST_API_KEY=preprodxg6GaNVZoHWUfQd7HQcgUg8epWhE1aMi
++ BLOCKFROST_API_KEY=preprodxg6GaNVZoHWUfQd7HQcgUg8epWhE1aMi
++ export BLOCKFROST_API=https://cardano-preprod.blockfrost.io/api/v0
++ BLOCKFROST_API=https://cardano-preprod.blockfrost.io/api/v0
+ '[' preprod == mainnet ']'
+ network='--testnet-magic 1'
+ echo 'Socket path: /var/snap/docker/common/var-lib-docker/volumes/cardano-ipc/_data/node.socket'
Socket path: /var/snap/docker/common/var-lib-docker/volumes/cardano-ipc/_data/node.socket
+ ls -al /var/snap/docker/common/var-lib-docker/volumes/cardano-ipc/_data/node.socket
srwxrwxrwx 1 root root 0 Nov  6 07:52 /var/snap/docker/common/var-lib-docker/volumes/cardano-ipc/_data/node.socket
+ mkdir -p /home/lawrence/src/traceability-smart-contract/work
+ mkdir -p /home/lawrence/src/traceability-smart-contract/work-backup
+ rm -f /home/lawrence/src/traceability-smart-contract/work/add-ada-tx-alonzo.body /home/lawrence/src/traceability-smart-contract/work/add-ada-tx-alonzo.tx /home/lawrence/src/traceability-smart-contract/work/admin-utxo-collateral-valid.json /home/lawrence/src/traceability-smart-contract/work/admin-utxo-valid.json /home/lawrence/src/traceability-smart-contract/work/admin-utxo.json /home/lawrence/src/traceability-smart-contract/work/pparms.json
+ rm -f '/home/lawrence/src/traceability-smart-contract/work-backup/*'
+ order_utxo_in=1c335fe9e3912f5b6b3a0245d9cc756fe883fdf6cd69e2d5fec141199eea35f0
+ order_utxo_in_txid=1c335fe9e3912f5b6b3a0245d9cc756fe883fdf6cd69e2d5fec141199eea35f0#0
+ /usr/local/bin/cardano-cli query protocol-parameters --testnet-magic 1 --out-file /home/lawrence/src/traceability-smart-contract/work/pparms.json
+ validator_script=/home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/data/earthtrust-validator.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/data/earthtrust-validator.plutus --testnet-magic 1
+ validator_script_addr=addr_test1wp98u3s8wjrfxpjlerzlw2wg9a6k5ws8cc25gadtcxfe7xs6g8lm9
+ redeemer_file_path=/home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/data/redeemer-earthtrust-refund.json
++ cat /home/lawrence/.local/keys/testnet/admin/admin.hash
+ admin_pkh=b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682
++ /usr/local/bin/cardano-cli address build --testnet-magic 1 --payment-verification-key-file /home/lawrence/.local/keys/testnet/admin/admin.vkey
+ admin_utxo_addr=addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7
+ /usr/local/bin/cardano-cli query utxo --address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --cardano-mode --testnet-magic 1 --out-file /home/lawrence/src/traceability-smart-contract/work/admin-utxo.json
+ cat /home/lawrence/src/traceability-smart-contract/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 77228cd2d2f7b545f19f9292c3978bff931a8ff920978781e58b258277719242#0
++ tr -d '\n'
+ admin_utxo_in=77228cd2d2f7b545f19f9292c3978bff931a8ff920978781e58b258277719242#0
+ cat /home/lawrence/src/traceability-smart-contract/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace == 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 5052d9b69c914b61cefb7667d54b023de53e0b1368bf436aff1f141d0f675559#0
++ tr -d '\n'
+ admin_utxo_collateral_in=5052d9b69c914b61cefb7667d54b023de53e0b1368bf436aff1f141d0f675559#0
+ /usr/local/bin/cardano-cli query utxo --address addr_test1wp98u3s8wjrfxpjlerzlw2wg9a6k5ws8cc25gadtcxfe7xs6g8lm9 --testnet-magic 1 --out-file /home/lawrence/src/traceability-smart-contract/work/validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.inlineDatum 
| length > 0) | .key' /home/lawrence/src/traceability-smart-contract/work/validator-utxo.json
+ order_utxo_in=1c335fe9e3912f5b6b3a0245d9cc756fe883fdf6cd69e2d5fec141199eea35f0#0
++ jq -r 'to_entries[] 
| select(.value.inlineDatum 
| length > 0) 
| .value.inlineDatum' /home/lawrence/src/traceability-smart-contract/work/validator-utxo.json
+ order_datum_in='{
  "constructor": 0,
  "fields": [
    {
      "int": 101260000
    },
    {
      "bytes": "34363532393135303634383937"
    }
  ]
}'
+ echo -n '{
  "constructor": 0,
  "fields": [
    {
      "int": 101260000
    },
    {
      "bytes": "34363532393135303634383937"
    }
  ]
}'
++ jq -r '.fields[0].int' /home/lawrence/src/traceability-smart-contract/work/datum-in.json
+ order_ada=101260000
++ jq -r '.fields[1].bytes' /home/lawrence/src/traceability-smart-contract/work/datum-in.json
+ order_id=34363532393135303634383937
++ echo -n 34363532393135303634383937=
++ xxd -r -p
+ order_id_non_hex=4652915064897
++ date +%Y/%m/%d-%H:%M:%S
+ now=2022/11/06-15:10:26
+ metadata='{
"1" : {
    "refund_detail" : {
        "date" : "2022/11/06-15:10:26",
        "order_id" : "4652915064897",
        "refund_ada_amount" : "101260000",
        "version" : "1.0"
        }
    }
}'
+ echo '{' '"1"' : '{' '"refund_detail"' : '{' '"date"' : '"2022/11/06-15:10:26",' '"order_id"' : '"4652915064897",' '"refund_ada_amount"' : '"101260000",' '"version"' : '"1.0"' '}' '}' '}'
+ metadata_file_path=/home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/data/earthtrust-refund-metadata.json
+ /usr/local/bin/cardano-cli transaction build --babbage-era --cardano-mode --testnet-magic 1 --change-address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --tx-in-collateral 5052d9b69c914b61cefb7667d54b023de53e0b1368bf436aff1f141d0f675559#0 --tx-in 77228cd2d2f7b545f19f9292c3978bff931a8ff920978781e58b258277719242#0 --tx-in 1c335fe9e3912f5b6b3a0245d9cc756fe883fdf6cd69e2d5fec141199eea35f0#0 --spending-tx-in-reference b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18#1 --spending-plutus-script-v2 --spending-reference-tx-in-inline-datum-present --spending-reference-tx-in-redeemer-file /home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/data/redeemer-earthtrust-refund.json --tx-out addr_test1vzs24vjh8salzqt5pahgvr34ewfwagxaxr5pz7eswugzn2gmw4f5w+101260000 --required-signer-hash b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682 --protocol-params-file /home/lawrence/src/traceability-smart-contract/work/pparms.json --metadata-json-file /home/lawrence/src/traceability-smart-contract/scripts/cardano-cli/preprod/data/earthtrust-refund-metadata.json --out-file /home/lawrence/src/traceability-smart-contract/work/add-ada-tx-alonzo.body
Estimated transaction fee: Lovelace 285613
+ echo 'tx has been built'
tx has been built
+ /usr/local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/traceability-smart-contract/work/add-ada-tx-alonzo.body --testnet-magic 1 --signing-key-file /home/lawrence/.local/keys/testnet/admin/admin.skey --out-file /home/lawrence/src/traceability-smart-contract/work/add-ada-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /usr/local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/traceability-smart-contract/work/add-ada-tx-alonzo.tx --testnet-magic 1
Transaction successfully submitted.



[nix-shell:~/src/traceability-smart-contract/scripts/cardano-cli]$ cardano-cli query utxo --address addr_test1wp98u3s8wjrfxpjlerzlw2wg9a6k5ws8cc25gadtcxfe7xs6g8lm9 --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
b29ef55ae27c5e5942a18ed5545b461c84610bab66bd59b18d37e712fe67cb18     1        20000000 lovelace + TxOutDatumNone



